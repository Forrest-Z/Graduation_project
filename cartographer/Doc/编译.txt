catkin_make_isolated --install --use-ninja
source install_isolated/setup.bash

#录制包
rosbag record -a

#纯激光建图
roslaunch cartographer_ros demo_revo_lds.launch
#激光+imu建图
roslaunch cartographer_ros dyp_backpack_2d.launch 

#结束建图
rosservice call /finish_trajectory 0
rosservice call /write_state "{filename: '${HOME}/Downloads/902.pbstream'}"
rosrun cartographer_ros cartographer_pbstream_to_ros_map  -map_filestem=${HOME}/Downloads/902  -pbstream_filename=${HOME}/Downloads/902.pbstream -resolution=0.05


#纯定位，激光+imu
roslaunch cartographer_ros demo_backpack_2d_localization.launch    load_state_filename:=${HOME}/Downloads/902/902.pbstream    bag_filename:=${HOME}/Downloads/902/902.bag



<node name="playbag" pkg="rosbag" type="play"  args="--clock $(arg bag_filename)" />


报错原因总结：
1.是否使用了imu数据，lua文件
2.节点重映射是否，imu，scan
3.urdf文件中，imu，lidar绑定的fram id 也就是关节是否对应
4. <param name="/use_sim_time" value="false" />
   设置为true，此时说明系统使用的是仿真时间，如果设置为false，则系统使用walltime










一、纯定位仿真测试
官方文档提供了纯定位的仿真教程，步骤如下：
下载数据集
wget -P ~/Downloads https://storage.googleapis.com/cartographer-public-data/bags/backpack_2d/b2-2016-04-05-14-44-52.bag
建图
roslaunch cartographer_ros offline_backpack_2d.launch bag_filenames:=${HOME}/Downloads/b2-2016-04-05-14-44-52.bag
纯定位测试

这里后面两个参数一个是上一步建好的地图，pbstream格式，另一个是数据集
roslaunch cartographer_ros demo_backpack_2d_localization.launch \
   load_state_filename:=${HOME}/Downloads/b2-2016-04-05-14-44-52.bag.pbstream \
   bag_filename:=${HOME}/Downloads/b2-2016-04-05-14-44-52.bag
也就是说，先用第一个数据集建图，建完图后用第二个数据集进行定位测试。

rosbag record -a